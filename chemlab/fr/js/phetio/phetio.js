// Copyright 2002-2016, University of Colorado Boulder
// This PhET-iO file requires a license
// USE WITHOUT A LICENSE AGREEMENT IS STRICTLY PROHIBITED.
// For licensing, please contact phethelp@colorado.edu

window.useRelativeSimPath=true;!function(e,a){"use strict";"function"==typeof define&&define.amd?define([],a):"object"==typeof module&&module.exports?module.exports=a():e.QueryStringMachine=a()}(this,function(){"use strict";var e=",",a="object"==typeof window?window.assert:global.assert;return function(){var t={get:function(e,a){return this.getForString(window.location.search,e,a)},getAll:function(e){return this.getAllForString(window.location.search,e)},getForString:function(e,t,r){return i(t,r),a&&a(0===e.length||0===e.indexOf("?"),'Query strings should be either the empty string or start with a "?": '+e),f(t,r,n(t,e))},getAllForString:function(e,a){var t={};for(var n in a)a.hasOwnProperty(n)&&(t[n]=this.getForString(e,n,a[n]));return t},containsKey:function(e){return this.containsKeyForString(window.location.search,e)},containsKeyForString:function(e,a){var t=n(a,e);return t.length>0}},n=function(e,a){for(var t=[],n=a.slice(1).split("&"),i=0;i<n.length;i++){var r=n[i].split("=");r[0]===e&&(r[1]?t.push(decodeURIComponent(r[1])):t.push(null))}return t},i=function(e,a){if(y(a.hasOwnProperty("type"),e,"type field is required"),y(O.hasOwnProperty(a.type),e,"invalid type: "+a.type),y(!a.hasOwnProperty("parse")||"function"==typeof a.parse,e,"parse must be a function"),y(!(a.hasOwnProperty("validValues")&&a.hasOwnProperty("isValidValue")),e,"validValues and isValidValue are mutually exclusive"),y(!a.hasOwnProperty("validValues")||a.validValues instanceof Array,e,"isValidValue must be a function"),y(!a.hasOwnProperty("isValidValue")||"function"==typeof a.isValidValue,e,"isValidValue must be a function"),a.hasOwnProperty("defaultValue")&&a.hasOwnProperty("validValues"))if("array"===a.type){var t=!1;a.validValues.forEach(function(e){_.isEqual(e,a.defaultValue)&&(t=!0)}),y(t,e,"defaultValue must be a member of validValues")}else y(-1!==a.validValues.indexOf(a.defaultValue),e,"defaultValue must be a member of validValues");c(e,a,O[a.type].required,O[a.type].optional),O[a.type].validate(e,a)},r=function(e,a){},l=function(e,a){a.hasOwnProperty("defaultValue")&&y(a.defaultValue===!0||a.defaultValue===!1,e,"invalid defaultValue: "+a.defaultValue)},o=function(e,a){a.hasOwnProperty("defaultValue")&&y("number"==typeof a.defaultValue,e,"invalid defaultValue: "+a.defaultValue),a.hasOwnProperty("validValues")&&a.validValues.forEach(function(a){y("number"==typeof a,e,"invalid entry in validValues: "+a)})},u=function(e,a){a.hasOwnProperty("defaultValue")&&y("string"==typeof a.defaultValue||null===a.defaultValue,e,"invalid defaultValue: "+a.defaultValue),a.hasOwnProperty("validValues")&&a.validValues.forEach(function(a){y("string"==typeof a||null===a,e,"invalid entry in validValues: "+a)})},s=function(e,a){a.hasOwnProperty("defaultValue")&&y(a.defaultValue instanceof Array||null===a.defaultValue,e,"invalid defaultValue: "+a.defaultValue),a.hasOwnProperty("validValues")&&a.validValues.forEach(function(a){y(a instanceof Array||null===a,e,"invalid entry in validValues: "+a)}),a.hasOwnProperty("separator")&&y("string"==typeof a.separator&&1===a.separator.length,e,"invalid separator: "+a.separator),i(e+".element",a.elementSchema)},d=function(e,a){},c=function(e,a,t,n){var i=Object.getOwnPropertyNames(a);t.forEach(function(a){y(-1!==i.indexOf(a),e,"missing required property: "+a)});var r=t.concat(n);i.forEach(function(a){y("type"===a||-1!==r.indexOf(a),e,"unsupported property: "+a)})},f=function(e,a,t){return y(t.length<=1,e,"query parameter cannot occur multiple times"),O[a.type].parse(e,a,t[0])},p=function(e,a,t){return y(void 0===t||null===t,e,"flag type does not support a value: "+t),void 0!==t},v=function(e,a,t){var n=null;return void 0===t?n=a.hasOwnProperty("defaultValue")?a.defaultValue:!0:(y("true"===t||"false"===t,e,"invalid value: "+t),n="true"===t),y("boolean"==typeof n,e,"invalid value: "+n),n},h=function(e,a,t){var n=null;return n=void 0===t?a.defaultValue:Number(t),y(!isNaN(n),e,"invalid value: "+t),y("number"==typeof n,e,"invalid value: "+n),a.hasOwnProperty("validValues")?y(-1!==a.validValues.indexOf(n),e,"invalid value: "+n):a.hasOwnProperty("isValidValue")&&y(a.isValidValue(n),e,"invalid value: "+n),n},m=function(e,a,t){var n=null;return n=void 0===t?a.defaultValue:t,y(null===n||"string"==typeof n,e,"invalid value: "+n),a.hasOwnProperty("validValues")?y(-1!==a.validValues.indexOf(n),e,"invalid value: "+n):a.hasOwnProperty("isValidValue")&&y(a.isValidValue(n),e,"invalid value: "+n),n},V=function(a,t,n){var i=null;if(i=void 0===n?t.defaultValue:null===n?[]:n.split(t.separator||e).map(function(e){return f(a,t.elementSchema,[e])}),t.hasOwnProperty("validValues")){for(var r=!1,l=0;l<t.validValues.length;l++){var o=t.validValues[l];if(_.isEqual(o,i)){r=!0;break}}y(r,a,"invalid value: "+JSON.stringify(i))}else t.hasOwnProperty("isValidValue")&&y(t.isValidValue(i),a,"invalid value: "+i);return i},g=function(e,a,t){var n=null;return n=void 0===t?a.defaultValue:a.parse(t),a.hasOwnProperty("validValues")?y(-1!==a.validValues.indexOf(n),e,"invalid value: "+n):a.hasOwnProperty("isValidValue")&&y(a.isValidValue(n),e,"invalid value: "+n),n},y=function(e,a,t){if(!e)throw console&&console.log&&console.log(w(a,t)),new Error("Assertion failed: "+t)},w=function(e,a){return'Error for query parameter "'+e+'": '+a},O={flag:{required:[],optional:[],validate:r,parse:p},"boolean":{required:[],optional:["defaultValue"],validate:l,parse:v},number:{required:[],optional:["defaultValue","validValues","isValidValue"],validate:o,parse:h},string:{required:[],optional:["defaultValue","validValues","isValidValue"],validate:u,parse:m},array:{required:["elementSchema"],optional:["defaultValue","validValues","isValidValue","separator","validValues"],validate:s,parse:V},custom:{required:["parse"],optional:["defaultValue","validValues","isValidValue"],validate:d,parse:g}};return t}()}),function(){"use strict";var e="phet-io-0.0.1",a={};window.SimIFrameClient=function(t){function n(e){try{var a=JSON.parse(e);if(a&&"object"==typeof a)return a}catch(t){}return!1}var i=1,r=[],l=[],o=0,u=function(e){e.functionHandle&&a[e.functionHandle].apply(void 0,e.args);for(var t=0;t<r.length;t++)if(e.request&&e.request.messageID&&r[t].message.messageID===e.request.messageID)return void(e.returnValues?r[t].callback&&r[t].callback.apply(null,e.returnValues):r[t].callback(e.returnValue));for(t=0;t<l.length;t++)l[t](e)},s=[],d=function(e){var a=n(e.data);if(a&&e.source===t.contentWindow&&a.protocol&&0===a.protocol.indexOf("phet-io-")){"phet-io-0.0.1"!==a.protocol&&console.log("Protocol mismatch: "+a.protocol+", currently supports phet-io-0.0.1"),s.push(a);for(var i=s.length-1;i>=0;i--)s[i].postMessageIndex===o&&(u(s[i]),o=s[i].postMessageIndex+1,s.splice(i,1),i=s.length);assert&&assert(s.length<1e3,"too many out of order messages")}};return window.addEventListener("message",d,!1),{frame:t,invokeSequence:function(a,n){for(var l=[],o=0;o<a.length;o++){var u=a[o],s=this.wrap(u.phetioID,u.method,u.args);l.push(s)}var d={messageID:i,protocol:e,messages:l};r.push({message:d,callback:n}),t.contentWindow.postMessage(JSON.stringify(d),"*"),i++},invoke:function(e,a,n,l){var o=this.wrap(e,a,n,l);l&&r.push({message:o,callback:l}),t.contentWindow.postMessage(JSON.stringify(o),"*"),i++},wrap:function(t,n,r){var l={phetioID:t,method:n,args:r,messageID:i,protocol:e};if(l.args)for(var o=0;o<l.args.length;o++){var u=l.args[o];if("function"==typeof u){var s="functionHandle@messageID="+l.messageID+", argIndex="+o;a[s]=l.args[o],l.args[o]=s}}return l},addMessageListener:function(e){l.push(e)},removeMessageListener:function(e){var a=l.indexOf(e);-1!==a&&l.splice(a,1)},dispose:function(){window.removeEventListener("message",d,!1)},onSimInitialized:function(e){this.addMessageListener(function(a){"simInitialized"===a.command&&e(a)})},onPhETiOInitialized:function(e){this.addMessageListener(function(a){"simIFrameAPIInitialized"===a.command&&e(a)})},launchSim:function(e,a){a=a||{},a.passThroughQueryParameters=a.hasOwnProperty("passThroughQueryParameters")?a.passThroughQueryParameters:!0,a.emitStates=a.emitStates||!1,a.emitInputEvents=a.emitInputEvents||!1,a.phetioEventsListener=a.phetioEventsListener||null,a.callback=a.callback||function(){},a.expressions=a.expressions||[],a.onSimInitialized=a.onSimInitialized||function(){},a.onPhETiOInitialized=a.onPhETiOInitialized||function(){},a.emitStates=QueryStringMachine.get("phetioEmitStates",{type:"boolean",defaultValue:a.emitStates}),a.emitInputEvents=QueryStringMachine.get("phetioEmitInputEvents",{type:"boolean",defaultValue:a.emitInputEvents}),this.onSimInitialized(a.onSimInitialized);var t=this,n=function(){t.invoke("phetio","addExpressions",[a.expressions],function(){t.invoke("phetio","launchSimulation",[],a.callback)})};this.onPhETiOInitialized(function(){a.onPhETiOInitialized(),a.phetioEventsListener?t.invoke("phetio","addPhETIOEventsListener",[a.phetioEventsListener],n):n()});var i=e+(QueryStringMachine.containsKey("phetioEmitStates")?"":"&phetioEmitStates="+a.emitStates)+(QueryStringMachine.containsKey("phetioEmitInputEvents")?"":"&phetioEmitInputEvents="+a.emitInputEvents);a.passThroughQueryParameters&&window.location.search.length>0&&(i=i+"&"+window.location.search.substring(1)),t.frame.src=i}}}}(),function(){"use strict";window.assert=function(e,a){if(!e)throw console.log(a),new Error(a)}}(),function(){"use strict";function e(e){var a="",t=e.replace(/\d/g,function(e){return e+" "}).trim();return t.split("-").forEach(function(e,t){a+=0===t?e:e[0].toUpperCase()+e.slice(1)}),a.length>1?a=a.charAt(0).toLowerCase()+a.slice(1):1===a.length&&(a=a.toLowerCase()),a}var a=function(e){if(e=QueryStringMachine.get("sim",{type:"string",defaultValue:e}),"$"===e.charAt(0))throw new Error("variable was not filled in, specify in getSim call or in ?sim= query parameter");return e},t=function(e,t){var n=a(e);return QueryStringMachine.get("launchLocalVersion",{type:"flag"})?"../../"+n+"_en-phetio.html?production":"{{"!==t.substring(0,2)?"https://phet-io.colorado.edu/sims/"+n+"/"+t+"/"+n+"_en-phetio.html?production":QueryStringMachine.containsKey("sim")?"../../../"+n+"/"+n+"_en.html?brand=phet-io":"../../"+n+"_en-phetio.html?production"};window.WrapperUtils={getSim:function(n,i){n=a(n);var r=t(n,i);return{name:n,URL:r,camelCaseName:e(n)}}}}();